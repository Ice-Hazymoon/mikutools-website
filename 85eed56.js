(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{1550:function(t,n,e){t.exports={}},2867:function(t,n,e){"use strict";e(1550)},3092:function(t,n,e){"use strict";e.r(n);e(528),e(23),e(21),e(68),e(59),e(13),e(33);var o=e(47),r=e.n(o),c=e(318),l={name:"UserIndex",head:function(){return{titleTemplate:"用户中心 - %s"}},data:function(){return{data:{},cardKey:"",cardLoading:!1,transformAffLoading:!1,auth_notification_status:"检测中···"}},computed:{auth_notification_status_color:function(){return"检测中···"===this.auth_notification_status?"warning":"已授权"===this.auth_notification_status?"success":"未授权"===this.auth_notification_status?"info":"danger"}},watch:{"$store.state.user":function(t){t.id||this.$router.replace("/")}},mounted:function(){var t=this;setTimeout((function(){var n=t.$store.state,e=n.user,o=n.verify;!e.id&&o?(t.$message.error("请先登录"),t.$router.replace("/")):(t.getInfo(),t.webpush())}),0)},methods:{formatDate:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YYYY-MM-DD HH:mm:ss";return n?r.a.unix(t).format(e):r()(t).format(e)},VerifyMail:function(){var t=this;this.$confirm("是否重新发送验证邮件？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.commit("loadingComponent",!0),t.$axios.post("/user/verify_mail",{mail:t.data.mail}).then((function(){t.$notify.success({title:"发送成功",message:"请查看收件箱或垃圾箱"}),t.$store.commit("loadingComponent",!1)})).catch((function(n){t.$notify.error({title:"发送失败",message:n}),t.$store.commit("loadingComponent",!1)}))})).catch((function(){}))},logout:function(){var t=this;this.$store.state.user.id&&this.$confirm("是否退出登陆","确认信息").then((function(){t.$router.replace("/"),t.$store.commit("SET_STORE",{key:"user",value:{token:"",id:"",meta:{}}}),t.$message.success("退出成功")})).catch((function(){}))},getInfo:function(){var t=this;this.data={},this.$axios.post("/user/info").then((function(n){t.data=n.data.data,t.data.verify})).catch((function(n){t.$notify.error({title:"获取用户信息失败",message:n})}))},activateCard:function(){var t=this;return!this.cardLoading&&(!!this.cardKey&&(this.cardLoading=!0,void this.$axios.post("/user/vip",{key:this.cardKey}).then((function(){t.cardLoading=!1,alert("激活成功，感谢您的支持"),t.$message.success("激活成功，感谢您的支持"),t.getInfo()})).catch((function(n){t.cardLoading=!1,alert("激活失败，可能是激活码输入错误或已使用过激活码，可查看VIP到期时间判断"),t.$notify.error({title:"激活失败",message:n})}))))},transformAff:function(){var t=this,n=Math.floor((this.data.aff-this.data.transform_aff)/5);return n<1?this.$notify.error({title:"兑换失败",message:"可兑换人数不足5人，无法兑换"}):!this.transformAffLoading&&void this.$confirm("预计可转换为".concat(n,"天VIP"),"是否继续",{confirmButtonText:"确认转换",cancelButtonText:"取消",type:"warning"}).then((function(){t.transformAffLoading=!0,t.$axios.post("/user/transform_aff").then((function(n){t.transformAffLoading=!1,t.$notify.success({title:"转换成功",message:"获得".concat(n.data.data,"个月VIP")}),t.getInfo()})).catch((function(n){t.transformAffLoading=!1,t.$notify.error({title:"转换失败",message:n})}))})).catch((function(){}))},copy:function(text){var t=this;this.$copyText(text).then((function(){t.$message.success("复制成功")}),(function(){t.$message.error("复制失败，请手动选择复制")}))},webpush:function(){var t=this;this.$store.state.auth_notification?Object(c.a)().then((function(sub){var n=JSON.stringify(sub),data=JSON.parse(n);return t.$axios.post("/user/endpoint",{endpoint:data.endpoint,auth:data.keys.auth,p256dh:data.keys.p256dh})})).then((function(){t.auth_notification_status="已授权"})).catch((function(n){t.auth_notification_status="授权失败，请检查浏览器设置",console.log("授权通知失败",n)})):this.auth_notification_status="未授权"},re_webpush:function(){this.auth_notification_status="检测中···",this.$store.commit("SET_STORE",{key:"auth_notification",value:!0}),this.webpush()},checkOrder:function(t){var n=this;this.$axios.post("/user/pay/checkOrder",{orderNo:t}).then((function(t){t.data.data.status?(n.$notify.success({title:"更新状态成功",message:"该笔订单已支付"}),n.getInfo()):n.$notify.error({title:"更新状态失败",message:"该笔订单未支付"})})).catch((function(t){n.$notify.error({title:"更新状态失败",message:t})}))}}},f=l,d=(e(2867),e(6)),component=Object(d.a)(f,(function(){var t=this,n=t._self._c;return n("div",{staticClass:"user-index"},[n("nya-container",{attrs:{main:"",title:"用户中心"}},[t.data.mail?n("div",{staticClass:"content"},[n("p",[n("b",[t._v("注册时间：")]),t._v(t._s(t.formatDate(t.data.unix)))]),n("p",[n("b",[t._v("ID：")]),n("el-tag",{staticClass:"cursor-pointer",attrs:{size:"small"},on:{click:function(n){return t.copy(t.data.id)}}},[t._v("\n                    "+t._s(t.data.id)+"\n                ")])],1),n("p",[n("b",[t._v("邮箱：")]),n("el-tooltip",{attrs:{effect:"dark",content:t.data.verify?"已验证，点击复制":"未验证，点击重新发送验证邮件",placement:"bottom"}},[n("el-tag",{staticClass:"cursor-pointer",attrs:{type:t.data.verify?"success":"danger",size:"small"},on:{click:function(n){t.data.verify?t.copy(t.data.mail):t.VerifyMail()}}},[t._v("\n                        "+t._s(t.data.mail)+"\n                    ")])],1)],1),n("p",[n("b",[t._v("VIP到期时间：")]),n("span",{staticStyle:{color:"red"}},[t.data.vip_permanent?n("span",[t._v("永久会员")]):n("span",[t._v(t._s(t.data.vip?t.formatDate(t.data.vip):"未开通"))])])]),t.$store.state.env.isWeb?n("p",{staticClass:"mb-0"},[n("b",[t._v("授权本站发送通知：")]),n("el-tooltip",{attrs:{transition:"el-fade-in",effect:"dark",content:"点击重新授权",placement:"bottom"}},[n("el-tag",{staticClass:"cursor-pointer",attrs:{type:t.auth_notification_status_color,size:"small"},on:{click:t.re_webpush}},[t._v("\n                        "+t._s(t.auth_notification_status)+"\n                    ")])],1)],1):t._e(),n("hr"),n("p",[t._v("\n                你可以通过 "),n("nuxt-link",{attrs:{to:"/user/pay"}},[t._v("\n                    点击捐赠\n                ")]),t._v(" 成为本站VIP\n            ")],1),n("div",{staticClass:"nya-subtitle"},[t._v("\n                使用激活码激活 VIP\n            ")]),n("el-input",{staticClass:"mb-15",attrs:{placeholder:"在线支付无需激活码",size:"small",autocomplete:"off"},on:{keyup:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"enter",13,n.key,"Enter")?null:t.activateCard.apply(null,arguments)}},model:{value:t.cardKey,callback:function(n){t.cardKey="string"==typeof n?n.trim():n},expression:"cardKey"}},[n("el-button",{attrs:{slot:"append",loading:t.cardLoading},on:{click:t.activateCard},slot:"append"},[t._v("\n                    "+t._s(t.cardLoading?"激活中":"使用激活码")+"\n                ")])],1)],1):n("nya-loading"),t.$store.state.user.token?n("el-button",{attrs:{type:"primary",round:""},on:{click:t.logout}},[t._v("\n            退出登陆\n        ")]):t._e()],1),t.data.orders&&t.data.orders.length?n("nya-container",{attrs:{title:"我的订单"}},[t.data.orders?n("div",{staticClass:"content"},[n("el-table",{attrs:{data:t.data.orders,border:"",stripe:""}},[n("el-table-column",{attrs:{align:"center",prop:"out_trade_no",label:"订单号",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tag",{attrs:{size:"mini"},on:{click:function(n){return t.copy(e.row.out_trade_no)}}},[t._v("\n                            "+t._s(e.row.out_trade_no)+"\n                        ")])]}}],null,!1,2985369936)}),n("el-table-column",{attrs:{align:"center",label:"商品名称",width:"200"},scopedSlots:t._u([{key:"default",fn:function(n){return[t._v("\n                        "+t._s(n.row.product_name)+"\n                    ")]}}],null,!1,1866054510)}),n("el-table-column",{attrs:{align:"center",prop:"price",label:"价格",width:"80"}}),n("el-table-column",{attrs:{align:"center",label:"支付方式"},scopedSlots:t._u([{key:"default",fn:function(n){return[t._v("\n                        "+t._s(t.$store.state.payType[n.row.pay_type].name)+"\n                    ")]}}],null,!1,648128545)}),n("el-table-column",{attrs:{align:"center",prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.status?n("el-tag",{attrs:{type:"info"}},[t._v("\n                            未支付\n                        ")]):t._e(),1===e.row.status?n("el-tag",{attrs:{type:"success"}},[t._v("\n                            已支付\n                        ")]):t._e(),2===e.row.status?n("el-tag",{attrs:{type:"info"}},[t._v("\n                            已取消\n                        ")]):t._e(),3===e.row.status?n("el-tag",{attrs:{type:"info"}},[t._v("\n                            已退款\n                        ")]):t._e(),n("el-tooltip",{attrs:{effect:"dark",content:e.row.error,placement:"bottom"}},[-1===e.row.status?n("el-tag",{attrs:{type:"danger"}},[t._v("\n                                订单错误\n                            ")]):t._e()],1)]}}],null,!1,1372330)}),n("el-table-column",{attrs:{align:"center",prop:"unix",label:"创建时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(n){return[t._v("\n                        "+t._s(t.formatDate(n.row.unix,!1))+"\n                    ")]}}],null,!1,3522123024)}),n("el-table-column",{attrs:{align:"center",prop:"status",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{disabled:1===e.row.status,type:"text"},on:{click:function(n){return t.checkOrder(e.row.out_trade_no)}}},[t._v("\n                            刷新状态\n                        ")])]}}],null,!1,3413754992)})],1)],1):n("nya-loading")],1):t._e(),n("nya-container",{attrs:{title:"帮助"}},[n("ul",{staticClass:"nya-list"},[n("li",[t._v("任何问题请咨询站长微信：lovesnad")]),n("li",[t._v("激活码激活失败：仔细核对是否正确输入了激活码，请不要手动输入，直接复制粘贴即可")])])])],1)}),[],!1,null,null,null);n.default=component.exports}}]);