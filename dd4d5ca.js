(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{1495:function(t,e,r){t.exports={}},2621:function(t,e,r){"use strict";r(1495)},2959:function(t,e,r){"use strict";r.r(e);r(58),r(13),r(86),r(173),r(59),r(32);var n=r(205),o=r(206),h=(r(46),r(21),r(68),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(n.a)(this,t),this.drawto=e.to||document.getElementById("pixelitcanvas"),this.drawfrom=e.from||document.getElementById("pixelitimg"),this.hideFromImg(),this.scale=e.scale&&e.scale>0&&e.scale<=50?.01*e.scale:.08,this.palette=e.palette||[[140,143,174],[88,69,99],[62,33,55],[154,99,72],[215,155,125],[245,237,186],[192,199,65],[100,125,52],[228,148,58],[157,48,59],[210,100,113],[112,55,127],[126,196,193],[52,133,157],[23,67,75],[31,14,28]],this.maxHeight=e.maxHeight,this.maxWidth=e.maxWidth,this.ctx=this.drawto.getContext("2d"),this.endColorStats={}}return Object(o.a)(t,[{key:"hideFromImg",value:function(){return this.drawfrom.style.visibility="hidden",this.drawfrom.style.position="fixed",this.drawfrom.style.top=0,this.drawfrom.style.left=0,this}},{key:"setFromImgSource",value:function(t){return this.drawfrom.src=t,this}},{key:"setDrawFrom",value:function(t){return this.drawfrom=t,this}},{key:"setDrawTo",value:function(t){return this.drawto=t,this}},{key:"setPalette",value:function(t){return this.palette=t,this}},{key:"setMaxWidth",value:function(t){return this.maxWidth=t,this}},{key:"setMaxHeight",value:function(t){return this.maxHeight=t,this}},{key:"setScale",value:function(t){return this.scale=t>0&&t<=50?.01*t:.08,this}},{key:"getPalette",value:function(){return this.palette}},{key:"colorSim",value:function(t,e){var i,r,n=0;for(i=0,r=t.length;i<r;i++)n+=(t[i]-e[i])*(t[i]-e[i]);return Math.sqrt(n)}},{key:"similarColor",value:function(t){var e,r=this,n=[],o=this.colorSim(t,this.palette[0]);return this.palette.forEach((function(h){(e=r.colorSim(t,h))<=o&&(n=h,o=e)})),n}},{key:"pixelate",value:function(){this.drawto.width=this.drawfrom.naturalWidth,this.drawto.height=this.drawfrom.naturalHeight;var t=this.drawto.width*this.scale,e=this.drawto.height*this.scale,r=document.createElement("canvas");r.width=this.drawto.width,r.height=this.drawto.height,r.style.visibility="hidden",r.style.position="fixed",r.style.top="0",r.style.left="0",(this.drawto.width>900||this.drawto.height>900)&&(this.scale*=.5,t=this.drawto.width*this.scale,e=this.drawto.height*this.scale,r.width=Math.max(t,e)+50,r.height=Math.max(t,e)+50),r.getContext("2d").drawImage(this.drawfrom,0,0,t,e),document.body.appendChild(r),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1;var n=this.drawfrom.naturalWidth;this.drawfrom.naturalWidth>300&&(n+=this.drawfrom.naturalWidth>this.drawfrom.naturalHeight?parseInt(this.drawfrom.naturalWidth/(this.drawfrom.naturalWidth*this.scale))/1.5:parseInt(this.drawfrom.naturalWidth/(this.drawfrom.naturalWidth*this.scale)));var o=this.drawfrom.naturalHeight;return this.drawfrom.naturalHeight>300&&(o+=this.drawfrom.naturalHeight>this.drawfrom.naturalWidth?parseInt(this.drawfrom.naturalHeight/(this.drawfrom.naturalHeight*this.scale))/1.5:parseInt(this.drawfrom.naturalHeight/(this.drawfrom.naturalHeight*this.scale))),this.ctx.drawImage(r,0,0,t,e,0,0,n,o),r.remove(),this}},{key:"convertGrayscale",value:function(){for(var t=this.drawto.width,e=this.drawto.height,r=this.ctx.getImageData(0,0,t,e),n=0;n<r.height;n++)for(var o=0;o<r.width;o++){var i=4*n*r.width+4*o,h=(r.data[i]+r.data[i+1]+r.data[i+2])/3;r.data[i]=h,r.data[i+1]=h,r.data[i+2]=h}return this.ctx.putImageData(r,0,0,0,0,r.width,r.height),this}},{key:"convertPalette",value:function(){for(var t=this.drawto.width,e=this.drawto.height,r=this.ctx.getImageData(0,0,t,e),n=0;n<r.height;n++)for(var o=0;o<r.width;o++){var i=4*n*r.width+4*o,h=this.similarColor([r.data[i],r.data[i+1],r.data[i+2]]);r.data[i]=h[0],r.data[i+1]=h[1],r.data[i+2]=h[2]}return this.ctx.putImageData(r,0,0,0,0,r.width,r.height),this}},{key:"resizeImage",value:function(){var t=document.createElement("canvas"),e=t.getContext("2d"),r=1;return this.maxWidth||this.maxHeight?(this.maxWidth&&this.drawto.width>this.maxWidth&&(r=this.maxWidth/this.drawto.width),this.maxHeight&&this.drawto.height>this.maxHeight&&(r=this.maxHeight/this.drawto.height),t.width=this.drawto.width,t.height=this.drawto.height,e.drawImage(this.drawto,0,0),this.drawto.width=this.drawto.width*r,this.drawto.height=this.drawto.height*r,this.ctx.drawImage(t,0,0,t.width,t.height,0,0,this.drawto.width,this.drawto.height),this):0}},{key:"draw",value:function(){return this.drawto.width=this.drawfrom.width,this.drawto.height=this.drawfrom.height,this.ctx.drawImage(this.drawfrom,0,0),this.resizeImage(),this}},{key:"saveImage",value:function(){var link=document.createElement("a");link.download="pxArt.png",link.href=this.drawto.toDataURL("image/png").replace("image/png","image/octet-stream"),document.querySelector("body").appendChild(link),link.click(),document.querySelector("body").removeChild(link)}}]),t}()),l=h,c=r(370),d=r(959),m=[[[7,5,5],[33,25,25],[82,58,42],[138,107,62],[193,156,77],[234,219,116],[160,179,53],[83,124,68],[66,60,86],[89,111,175],[107,185,182],[251,250,249],[184,170,176],[121,112,126],[148,91,40]],[[13,43,69],[32,60,86],[84,78,104],[141,105,122],[208,129,89],[255,170,94],[255,212,163],[255,236,214]],[[43,15,84],[171,31,101],[255,79,105],[255,247,248],[255,129,66],[255,218,69],[51,104,220],[73,231,236]],[[48,0,48],[96,40,120],[248,144,32],[248,240,136]],[[239,26,26],[172,23,23],[243,216,216],[177,139,139],[53,52,65],[27,26,29]],[[26,28,44],[93,39,93],[177,62,83],[239,125,87],[255,205,117],[167,240,112],[56,183,100],[37,113,121],[41,54,111],[59,93,201],[65,166,246],[115,239,247],[244,244,244],[148,176,194],[86,108,134],[51,60,87]],[[44,33,55],[118,68,98],[237,180,161],[169,104,104]],[[171,97,135],[235,198,134],[216,232,230],[101,219,115],[112,157,207],[90,104,125],[33,30,51]],[[140,143,174],[88,69,99],[62,33,55],[154,99,72],[215,155,125],[245,237,186],[192,199,65],[100,125,52],[228,148,58],[157,48,59],[210,100,113],[112,55,127],[126,196,193],[52,133,157],[23,67,75],[31,14,28]],[[94,96,110],[34,52,209],[12,126,69],[68,170,204],[138,54,34],[235,138,96],[0,0,0],[92,46,120],[226,61,105],[170,92,61],[255,217,63],[181,181,181],[255,255,255]],[[49,31,95],[22,135,167],[31,213,188],[237,255,177]],[[21,25,26],[138,76,88],[217,98,117],[230,184,193],[69,107,115],[75,151,166],[165,189,194],[255,245,247]]],f={name:"PixelArt",data:function(){return{file:null,preview:null,results:null,paletteList:m,loading:!1,config:{greyscale:!1,palette:!1,max_height:null,max_width:null,block_size:7,select_palette:0}}},mounted:function(){},methods:{handleColors:function(t){return"#"+t.map((function(t){var e=t.toString(16);return 1===e.length?"0"+e:e})).join("")},selectPalette:function(t){this.config.select_palette=t,this.start()},onSelectFile:function(t){var e=this,r=t.target.files;if(!r.length)return!1;var n=r[0];n.size/1024/1024>5?(this.file=null,this.$notify.error({title:"上传失败",message:"请选择大小在5M以内的图片"})):Object(d.a)(n).then((function(t){e.preview=t,e.$nextTick((function(){e.start()}))}))},handleClear:function(){this.file=null,this.preview=null},start:function(){var t=this;if(!this.preview)return this.$notify.error({title:"错误",message:"请先上传图片"}),!1;this.results=null;var e={to:this.$refs.pixelitcanvas,from:this.$refs.pixelitimg,scale:this.config.block_size,palette:this.config.palette?m[this.config.select_palette]:null,maxHeight:this.config.max_height,maxWidth:this.config.max_width};setTimeout((function(){var r=new l(e).draw().pixelate();t.config.greyscale&&r.convertGrayscale(),t.config.palette&&r.convertPalette(),t.results=t.$refs.pixelitcanvas.toDataURL("image/png")}),0)},download:function(){c.a.bind(this)({url:this.results,filename:"[".concat("tools.miku.ac","][图片转像素画]-").concat(+Date.now(),".png")})}}},w=(r(2621),r(6)),v=function(t){t.exports.head={meta:[{hid:"keywords",keywords:"图片转像素画,像素画生成器,pixel-art,像素艺术,MikuTools,Ice-Hazymoon,在线工具"},{hid:"description",description:"把图片转换为像素画"}],title:"图片转像素画 - MikuTools"},t.options.toolsMeta={name:"图片转像素画",path:"/pixel_art",head:{meta:[{hid:"keywords",keywords:"图片转像素画,像素画生成器,pixel-art,像素艺术,MikuTools,Ice-Hazymoon,在线工具"},{hid:"description",description:"把图片转换为像素画"}],title:"图片转像素画 - MikuTools"},hot:"hot",vip:!1,platforms:["app-android","web-pc","web-mobile"],key:["image","hot"],icon:"$tabler$flower"}},component=Object(w.a)(f,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"pixel-art"},[e("nya-container",{attrs:{title:"图片转像素画"}},[e("div",{staticClass:"nya-subtitle"},[t._v("\n            上传图片\n        ")]),e("el-input",{staticClass:"mb-15",attrs:{type:"file",accept:"image/*",clearable:""},on:{clear:t.handleClear},nativeOn:{change:function(e){return t.onSelectFile.apply(null,arguments)}},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}}),t.preview?e("div",{staticClass:"preview"},[e("img",{attrs:{src:t.preview,alt:"预览图片"}})]):t._e(),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            像素大小: "+t._s(t.config.block_size)+"\n        ")]),e("el-slider",{attrs:{min:2,max:25},on:{change:t.start},model:{value:t.config.block_size,callback:function(e){t.$set(t.config,"block_size",e)},expression:"config.block_size"}}),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            其他选项:\n        ")]),e("div",{staticClass:"mt-15"},[e("el-checkbox",{on:{change:t.start},model:{value:t.config.greyscale,callback:function(e){t.$set(t.config,"greyscale",e)},expression:"config.greyscale"}},[t._v("\n                灰度图片\n            ")]),e("el-checkbox",{on:{change:t.start},model:{value:t.config.palette,callback:function(e){t.$set(t.config,"palette",e)},expression:"config.palette"}},[t._v("\n                调色盘\n            ")])],1),t.config.palette?e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            选择一组颜色:\n        ")]):t._e(),t.config.palette?e("div",{staticClass:"colorpad-box"},t._l(t.paletteList,(function(r,n){return e("div",{key:n,staticClass:"colorpad",class:n===t.config.select_palette?"active":"",on:{click:function(e){return t.selectPalette(n)}}},t._l(r,(function(r,o){return e("div",{key:n+"-"+o,style:{backgroundColor:t.handleColors(r)}})})),0)})),0):t._e()],1),t.preview?e("nya-container",{attrs:{title:"预览"}},[e("div",{staticClass:"mb-15"},[e("img",{ref:"pixelitimg",attrs:{src:t.preview,alt:"预览图片"}}),e("canvas",{ref:"pixelitcanvas"})]),e("el-button",{attrs:{type:"primary"},on:{click:t.download}},[t._v("\n            下载图片\n        ")])],1):t._e()],1)}),[],!1,null,null,null);"function"==typeof v&&v(component);e.default=component.exports},959:function(t,e,r){"use strict";r(13);e.a=function(t){return new Promise((function(e,r){var n=new FileReader;n.readAsDataURL(t),n.onload=function(){return e(n.result)},n.onerror=function(t){return r(t)}}))}}}]);