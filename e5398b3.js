(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{1212:function(t,e,n){"use strict";n(13),n(39),n(33),n(529),n(246);e.a=function(t){return new Promise((function(e,n){fetch(t).then((function(t){return t.blob()})).then((function(t){e(URL.createObjectURL(t))})).catch(n)}))}},1489:function(t,e,n){t.exports={}},2607:function(t,e,n){"use strict";n(1489)},3038:function(t,e,n){"use strict";n.r(e);var o,r=n(3),l=(n(25),n(21),n(68),n(59),n(58),n(13),n(39),n(33),n(529),n(246),n(69),n(32),n(46),n(1212)),c=n(959),d=n(370);o=n(1482);var m={name:"NovelAi",data:function(){return{is_start:!1,results:"",file:null,preview:null,base_image_md5:null,form:{input:"masterpiece, best quality, {best quality}, {{masterpiece}}, {highres}, original, extremely detailed wallpaper, 1girl,{an extremely delicate and beautiful}, {{angle}} , hair flower, illustration, school uniform, sunlight, detailed eyes, lily, white wings, ((halo)), silver hair,",uc:"lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts,signature, watermark, username, blurry, artist name,bad feet",ucPreset:2,model:"midjourney",resolution:"portrait",sampler:"DDIM",server:"vip",steps:25,scale:7,captcha:null},loading:!1,captchaImg:"",captchaId:null,error:null,progress:0,progressTimer:null,cacheHash:null,showcase:{data:[],page:1,pageCount:0},showShowcase:!1}},computed:{isVip:function(){return this.$store.state.user.meta.vip},progressColor:function(){return this.error?"var(--color-danger)":100===this.progress?"var(--color-success)":this.progress<20?"var(--color-text-placeholder)":this.progress<40?"var(--color-warning)":"var(--theme)"}},mounted:function(){},methods:{query_limit:function(){var t=this;this.$store.commit("loadingComponent",!0),this.$axios.post("/aidraw/query_limit").then((function(e){t.$notify.success({title:"查询成功",message:"您的剩余次数为：".concat(e.data.data.quota,"\n注意：累计次数达到上限后每日限额25次，永久会员每日50次")}),t.$store.commit("loadingComponent",!1)})).catch((function(e){t.$notify.error({title:"查询失败",message:e}),t.$store.commit("loadingComponent",!1)}))},handleClear:function(){this.file=null,this.preview=null,this.base_image_md5=null},onSelectFile:function(t){var e=this,n=t.target.files;if(!n.length)return!1;var o=n[0];o.size/1024/1024>5?(this.file=null,this.$notify.error({title:"上传失败",message:"请选择大小在5M以内的图片"})):Object(c.a)(o).then((function(t){e.base_image_md5=null,e.preview=t}))},start:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var form,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading){e.next=2;break}return e.abrupt("return",!1);case 2:if((form=t.form).input){e.next=5;break}return e.abrupt("return",t.$notify.error({title:"生成失败",message:"请输入文本"}));case 5:form.input?(t.is_start=!0,t.loading=!0,t.cacheHash=null,t.results="",t.handleProgress(),n={input:form.input,uc:form.uc,ucPreset:form.ucPreset,model:form.model,resolution:form.resolution,sampler:form.sampler,server:form.server,steps:form.steps,scale:form.scale,captcha:form.captcha,captcha_id:t.captchaId},t.preview&&(t.base_image_md5?n.base_image_md5=t.base_image_md5:n.base_image=null===(o=t.preview)||void 0===o?void 0:o.replace(/^data:image\/\w+;base64,/,"")),t.$axios.post("/aidraw",n,{timeout:3e5}).then((function(e){t.progress=100,t.cacheHash=e.data.data.hash,t.base_image_md5=e.data.data.base_image_md5,Object(l.a)("data:image/jpg;base64,".concat(e.data.data.url)).then((function(e){t.results=e,t.loading=!1}))})).catch((function(e){t.progress=100,t.error=e,t.$notify.error({title:"生成失败",message:e}),t.loading=!1}))):t.$notify.error({title:"生成失败",message:"请输入描述或标签"});case 6:case"end":return e.stop()}}),e)})))()},handleProgress:function(){var t=this;this.error=null,this.progress=0;this.progressTimer=setInterval((function(){if(t.progress<98){var e=1+~~(8*Math.random());t.progress>=50&&(e=1+~~(3*Math.random())),t.progress>=80&&(e=1+~~(1*Math.random())),t.progress+e>98?(t.progress=98,clearInterval(t.progressTimer)):t.progress+=e}else clearInterval(t.progressTimer)}),1e3)},download:function(t){d.a.bind(this)({url:t,filename:"aidraw_".concat((new Date).getTime(),".png")})},getCaptcha:function(){var t=this;if(this.isVip&&"vip"===this.form.server)return!1;this.$store.commit("loadingComponent",!0),this.captchaImg="",this.captchaId=null,this.form.captcha=null,this.$axios.post("/user/captcha").then((function(e){t.captchaImg=e.data.data.svg,t.captchaId=e.data.data.id,t.$store.commit("loadingComponent",!1)})).catch((function(e){t.$notify.error({title:"获取验证码失败",message:e}),t.$store.commit("loadingComponent",!1)}))},layout:function(){var t=this;this.$nextTick((function(){t.msnry=new o(t.$refs["showcase-box"],{percentPosition:!0,itemSelector:".showcase-box-item"})}))},doCopy:function(text){var t=this;this.$copyText(text).then((function(){t.$message.success("复制成功")}),(function(){t.$message.error("复制失败，请手动选择复制")}))},like:function(t){var e=this;if(t.liked)return!1;this.$store.commit("loadingComponent",!0),this.$axios.post("/aidraw/like",{id:t._id}).then((function(){t.liked=!0,e.$notify.success({title:"点赞成功",message:"该作品将会被更多人看到"}),e.$store.commit("loadingComponent",!1)})).catch((function(t){e.$notify.error({title:"点赞失败",message:t}),e.$store.commit("loadingComponent",!1)}))},share:function(){var t=this;this.$confirm("您生成的图片和描述审核成功后将被共享到本站供其它人参考","是否共享该图片",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$store.commit("loadingComponent",!0),t.$axios.post("/aidraw/share",{hash:t.cacheHash}).then((function(){t.$notify.success({title:"共享成功",message:"审核成功后将会显示在页面上"}),t.$store.commit("loadingComponent",!1)})).catch((function(e){t.$notify.error({title:"共享失败",message:e}),t.$store.commit("loadingComponent",!1)}))})).catch((function(){}))},getShowcase:function(t){var e=this;console.log(t||this.showcase.page),this.$store.commit("loadingComponent",!0),this.$axios.post("/aidraw/showcase",{page:t||this.showcase.page}).then((function(t){e.$store.commit("loadingComponent",!1),e.showcase.data=[],t.data.data=t.data.data.map((function(t){return t.hide=!1,t.data.url=new URL(t.data.url,e.$store.state.env.axios_cdn),t.checked=!1,t})),setTimeout((function(){t.data.data.length&&(e.showcase=t.data,e.$nextTick((function(){setTimeout((function(){e.layout()}),100)})))}),100)})).catch((function(t){e.$store.commit("loadingComponent",!1),e.$notify.error({title:"获取共享图片失败",message:t})}))},audit:function(t,e){var n=this;this.$store.commit("loadingComponent",!0),this.$axios.post("/aidraw/audit",{ids:[t._id],type:e}).then((function(){n.$store.commit("loadingComponent",!1),n.$notify.success({title:"审核成功",message:"该作品将会被更多人看到"}),t.hide=!0,n.$nextTick((function(){n.msnry.layout()}))})).catch((function(t){n.$store.commit("loadingComponent",!1),n.$notify.error({title:"审核失败",message:t})}))},auditSelect:function(t){var e=this,n=this.showcase.data.filter((function(t){return t.checked})).map((function(t){return t._id}));if(!n.length)return this.$notify.error({title:"审核失败",message:"请先选择要审核的作品"}),!1;this.$confirm("您确定要".concat(1===t?"通过":"拒绝","这").concat(n.length,"个作品的审核吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$store.commit("loadingComponent",!0),e.$axios.post("/aidraw/audit",{ids:n,type:t}).then((function(t){e.$notify.success({title:"审核成功",message:"共成功审核".concat(t.data.data.modifiedCount,"个作品")}),e.showcase.data.forEach((function(t){t.checked&&(t.hide=!0,t.checked=!1)})),e.$store.commit("loadingComponent",!1),e.$nextTick((function(){e.msnry.layout()}))})).catch((function(t){e.$store.commit("loadingComponent",!1),e.$notify.error({title:"审核失败",message:t})}))})).catch((function(){}))}}},h=(n(2607),n(6)),f=function(t){t.exports.head={meta:[{hid:"keywords",keywords:"AI 画图,NovelAi,MikuTools,Ice-Hazymoon,在线工具"},{hid:"description",description:"在线 AI 画图工具"}],title:"AI 画图（NovelAi） - MikuTools"},t.options.toolsMeta={name:"AI 画图（NovelAi）",path:"/novelai",head:{meta:[{hid:"keywords",keywords:"AI 画图,NovelAi,MikuTools,Ice-Hazymoon,在线工具"},{hid:"description",description:"在线 AI 画图工具"}],title:"AI 画图（NovelAi） - MikuTools"},hot:"hot",vip:!1,platforms:["app-android","web-pc","web-mobile"],key:["image","hot"],icon:"$tabler$brush"}},component=Object(h.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"novelai"},[e("nya-container",{attrs:{title:"AI 画图（NovelAi）"}},[e("div",{staticClass:"nya-subtitle"},[t._v("\n            上传图片（根据图片 AI 绘画）\n        ")]),e("el-input",{staticClass:"mb-15",attrs:{disabled:t.loading,type:"file",accept:"image/*",placeholder:t.file||"点击这里上传图片",clearable:""},on:{clear:t.handleClear},nativeOn:{change:function(e){return t.onSelectFile.apply(null,arguments)}},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}}),t.preview?e("div",{staticClass:"preview"},[e("img",{attrs:{src:t.preview,alt:"预览图片"}})]):t._e(),e("div",{staticClass:"nya-subtitle mt-15"},[e("span",[t._v("图片描述/标签")]),e("nuxt-link",{attrs:{to:"/novelai_tag"}},[t._v("\n                点我进入标签选择\n            ")])],1),e("el-input",{attrs:{disabled:t.loading,type:"textarea",autosize:{minRows:4,maxRows:8},autofocus:"",placeholder:"请描述你的图片"},model:{value:t.form.input,callback:function(e){t.$set(t.form,"input",e)},expression:"form.input"}}),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            手动排除标签\n        ")]),e("el-input",{attrs:{disabled:t.loading,type:"textarea",autosize:{minRows:4,maxRows:8},autofocus:"",placeholder:"请输入你想要排除的内容"},model:{value:t.form.uc,callback:function(e){t.$set(t.form,"uc",e)},expression:"form.uc"}}),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            排除标签预设\n        ")]),e("el-select",{staticClass:"full-width",attrs:{disabled:t.loading,placeholder:"请选择"},model:{value:t.form.ucPreset,callback:function(e){t.$set(t.form,"ucPreset",e)},expression:"form.ucPreset"}},[e("el-option",{attrs:{label:"排除低质量图片和奇怪的肢体",value:0}}),e("el-option",{attrs:{label:"排除低质量图片",value:1}}),e("el-option",{attrs:{label:"不选择排除预设",value:2}})],1),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            图片比例\n        ")]),e("el-select",{staticClass:"full-width",attrs:{disabled:t.loading,placeholder:"请选择宽高比"},model:{value:t.form.resolution,callback:function(e){t.$set(t.form,"resolution",e)},expression:"form.resolution"}},[e("el-option",{attrs:{label:"肖像（512×768）",value:"portrait"}}),e("el-option",{attrs:{label:"风景（768×512）",value:"landscape"}}),e("el-option",{attrs:{label:"正方形（640×640）",value:"square"}})],1),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            采样器\n        ")]),e("el-select",{staticClass:"full-width",attrs:{disabled:t.loading,placeholder:"不知道可以不选"},model:{value:t.form.sampler,callback:function(e){t.$set(t.form,"sampler",e)},expression:"form.sampler"}},[e("el-option",{attrs:{label:"DDIM",value:"DDIM"}}),e("el-option",{attrs:{label:"Euler",value:"Euler"}}),e("el-option",{attrs:{label:"Euler a",value:"Euler a"}}),e("el-option",{attrs:{label:"LMS",value:"LMS"}})],1),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            Steps: "+t._s(t.form.steps)+"\n        ")]),e("el-slider",{attrs:{disabled:t.loading,min:1,max:40},model:{value:t.form.steps,callback:function(e){t.$set(t.form,"steps",e)},expression:"form.steps"}}),e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            Scale: "+t._s(t.form.scale)+"\n        ")]),e("el-slider",{attrs:{disabled:t.loading,min:2,max:30,step:.5},model:{value:t.form.scale,callback:function(e){t.$set(t.form,"scale",e)},expression:"form.scale"}}),t.is_start?e("div",{staticClass:"nya-subtitle mt-15"},[t._v("\n            生成进度\n        ")]):t._e(),t.is_start?e("el-progress",{staticClass:"mt-15",attrs:{"text-inside":"","stroke-width":19,percentage:t.progress,color:t.progressColor}}):t._e(),e("el-button",{staticClass:"mt-15",attrs:{type:"primary",loading:t.loading},on:{click:t.start}},[t._v("\n            "+t._s(t.loading?"生成中":"开始生成")+"\n        ")])],1),t.results?e("nya-container",{attrs:{title:"生成成功"}},[e("img",{attrs:{src:t.results,alt:"results"}}),e("div",{staticClass:"mt-15"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.download(t.results)}}},[t._v("\n                下载图片\n            ")]),e("el-button",{staticClass:"ml-5",attrs:{type:"primary"},on:{click:function(e){return t.share(t.results)}}},[t._v("\n                共享该图片\n            ")])],1)]):t._e(),e("nya-container",{staticClass:"showcase",attrs:{title:"AI 画廊"}},[t.showcase.data.length?e("div",[t.$store.state.user.meta.mail===t.$store.state.env.admin?e("div",{staticClass:"mb015"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.auditSelect(1)}}},[t._v("\n                    通过\n                ")]),e("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.auditSelect(2)}}},[t._v("\n                    删除\n                ")]),e("el-button",{attrs:{type:"warning"},on:{click:function(e){return t.auditSelect(3)}}},[t._v("\n                    R18\n                ")])],1):t._e(),e("div",{ref:"showcase-box",staticClass:"showcase-box"},[t._l(t.showcase.data,(function(n,o){return[n.hide?t._e():e("div",{key:o,staticClass:"showcase-box-item"},[e("div",{staticClass:"showcase-box-item-body"},[e("div",{staticClass:"showcase-box-item-body-imgbox"},[e("img",{attrs:{width:n.data.width,height:n.data.height,src:n.data.url,alt:""}}),e("img",{attrs:{width:n.data.width,height:n.data.height,src:n.data.url,alt:""}}),e("div",{staticClass:"showcase-box-item-body-imgbox-like",attrs:{title:"点赞"},on:{click:function(e){return t.like(n)}}},[n.liked?e("i",{staticClass:"eva eva-heart"}):e("i",{staticClass:"eva eva-heart-outline"})])]),e("div",{staticClass:"showcase-box-item-info"},[e("div",{staticClass:"showcase-box-item-info-item"},[e("b",[t._v("Steps")]),t._v(": "+t._s(n.data.steps)+" / "),e("b",[t._v("Scale")]),t._v(": "+t._s(n.data.cfg_scale)+" / "+t._s(n.data.sampler_name)+"\n                                ")]),e("div",{staticClass:"showcase-box-item-info-item",attrs:{title:"点击复制"},on:{click:function(e){return t.doCopy(n.data.prompt)}}},[e("div",{staticClass:"showcase-box-item-info-item-tip"},[e("b",[t._v("Prompt")]),t._v(": "+t._s(n.data.prompt)+"\n                                    ")])]),e("div",{staticClass:"showcase-box-item-info-item",attrs:{title:"点击复制"},on:{click:function(e){return t.doCopy(n.data.negative_prompt)}}},[e("div",{staticClass:"showcase-box-item-info-item-tip"},[e("b",[t._v("Negative prompt")]),t._v(": "+t._s(n.data.negative_prompt)+"\n                                    ")])])]),t.$store.state.user.meta.mail===t.$store.state.env.admin?e("div",{staticClass:"showcase-box-item-action-admin"},[e("div",{on:{click:function(e){return t.audit(n,2)}}},[t._v("\n                                    删除\n                                ")]),e("div",{on:{click:function(e){return t.audit(n,1)}}},[t._v("\n                                    通过\n                                ")]),e("div",{on:{click:function(e){return t.audit(n,3)}}},[t._v("\n                                    R18\n                                ")])]):t._e(),t.$store.state.user.meta.mail===t.$store.state.env.admin?e("div",{staticClass:"showcase-box-item-action-admin"},[e("el-checkbox",{model:{value:n.checked,callback:function(e){t.$set(n,"checked",e)},expression:"item.checked"}},[t._v("\n                                    选择\n                                ")])],1):t._e()])])]}))],2),e("el-button",{staticClass:"reload",attrs:{round:"",type:"primary"},on:{click:function(e){return t.getShowcase()}}},[t._v("\n                换一批\n            ")])],1):e("div",{staticClass:"showcase-showbtn"},[e("el-button",{attrs:{round:""},on:{click:function(e){return t.getShowcase()}}},[t._v("\n                显示社区图片\n            ")])],1)]),e("nya-container",{attrs:{title:"参考"}},[t.$store.state.vip?e("el-button",{attrs:{size:"mini"},on:{click:t.query_limit}},[t._v("\n            查询我的剩余次数\n        ")]):t._e(),e("ul",{staticClass:"nya-list"},[e("li",[e("nuxt-link",{attrs:{to:"/novelai_tag"}},[t._v("\n                    点我进入标签选择器\n                ")])],1),e("li",[e("span",[t._v("相关工具：")]),e("a",{attrs:{href:"http://waifu2x.udp.jp/",target:"_blank",rel:"noopener noreferrer"}},[t._v("图片无损放大（waifu2x）")]),t._v("、\n                "),e("a",{attrs:{href:"https://github.com/xinntao/Real-ESRGAN-ncnn-vulkan/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("图片无损放大电脑版（Real-ESRGAN-ncnn-vulkan）")])]),e("li",[e("b",[t._v("由于使用人数较多，服务器压力过大，免费服务器暂时已下线")])]),e("li",[t._v("无法保存图片？请更换浏览器重试，推荐使用 chrome、edge、firefox 等现代浏览器")]),e("li",[t._v("\n                QQ闲聊群："),e("app-link",{attrs:{title:t.$store.state.env.QQGroupNumber,href:t.$store.state.env.QQGroup,target:"_blank",rel:"noopener noreferrer"}},[t._v("\n                    "+t._s(t.$store.state.env.QQGroupNumber)+"\n                ")])],1)])],1)],1)}),[],!1,null,null,null);"function"==typeof f&&f(component);e.default=component.exports},959:function(t,e,n){"use strict";n(13);e.a=function(t){return new Promise((function(e,n){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){return e(o.result)},o.onerror=function(t){return n(t)}}))}}}]);